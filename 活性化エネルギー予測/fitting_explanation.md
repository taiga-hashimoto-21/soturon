# フィッティングとは？

## 📊 簡単な例

### 例1: 体重と身長の関係

**データ:**
- 身長150cm → 体重40kg
- 身長160cm → 体重50kg
- 身長170cm → 体重60kg

**理論式:**
```
体重 = a × 身長 + b
```

**フィッティング = データに最も合う `a` と `b` を見つけること**

例えば、`a=1, b=-110` だとすると：
- 身長150cm → 体重 = 1×150 - 110 = 40kg ✓
- 身長160cm → 体重 = 1×160 - 110 = 50kg ✓
- 身長170cm → 体重 = 1×170 - 110 = 60kg ✓

これが「フィッティング成功」です！

---

## 🔬 今回のケース（PSDデータ）

### データ
PSDデータは3000個の数値の配列です：
```
[1.2e-23, 1.1e-23, 1.0e-23, 0.9e-23, ...]
```
これは、周波数0Hzから15000HzまでのPSD（パワースペクトル密度）の値です。

### 理論式
PSDデータは以下の理論式で表せるとされています：

```
S(f) = A_α / (1 + (f/f_α)²) + A_β / (1 + (f/f_β)²) + C
```

**パラメータ（未知数）:**
- `A_α`: α成分の振幅
- `f_α`: α成分の特徴周波数（Hz）
- `A_β`: β成分の振幅
- `f_β`: β成分の特徴周波数（Hz）
- `C`: 定数項

### フィッティングの目的

**PSDデータ（3000個の数値）に最も合う5つのパラメータを見つけること**

例えば：
- `f_α = 1000 Hz`（低周波数側の特徴周波数）
- `f_β = 5000 Hz`（中周波数側の特徴周波数）
- など

### なぜフィッティングが必要？

**`f_α` と `f_β` から活性化エネルギーを計算できるから！**

1. **`f_α` → 緩和時間 `τ_α`**
   ```
   τ_α = 1 / (2π × f_α)
   ```

2. **`τ_α` → 活性化エネルギー `E_α`**
   ```
   τ = 1 / (σ × exp(-E/(k_B T)) × N_T × ν)
   ```
   この式を逆算して `E_α` を求める

3. **同様に `f_β` → `E_β`**

---

## ⚠️ 現在の問題

### 問題1: フィッティングがうまくいっていない

**期待される動作:**
- PSDデータを分析して、最適な `f_α` と `f_β` を見つける
- 例: `f_α = 1200 Hz`, `f_β = 4500 Hz` など

**実際の動作:**
- 初期値（`f_α = 1500 Hz`, `f_β = 7500 Hz`）から動かない
- つまり、フィッティングが「データを無視している」状態

### 問題2: 活性化エネルギーが負の値になる

**期待される動作:**
- `f_α` と `f_β` から正しい活性化エネルギーを計算
- 例: `E_α = 5.0 meV`, `E_β = 20.0 meV` など

**実際の動作:**
- 計算結果が負の値になる（例: `E_α = -149 meV`）
- 範囲外なので、最小値（`E_α = 0.1 meV`）にクリップされる
- 全てのサンプルで同じ値（最小値）になる

### 結果

**ノイズ除去前後で同じ値になる → 改善度が0**

---

## 🔧 解決策

1. **フィッティングを改善する**
   - 初期値を適切に設定
   - 境界値を調整
   - フィッティングアルゴリズムを改善

2. **活性化エネルギーの計算式を確認する**
   - 計算式が正しいか確認
   - 物理定数が正しいか確認

---

## 📝 まとめ

**フィッティング = データに理論式を当てはめて、パラメータを見つけること**

今回のケースでは：
- **入力**: PSDデータ（3000個の数値）
- **出力**: `f_α` と `f_β`（周波数）
- **目的**: `f_α` と `f_β` から活性化エネルギーを計算

現在は、フィッティングがうまくいっていないため、全てのサンプルで同じ値（デフォルト値）になっています。

