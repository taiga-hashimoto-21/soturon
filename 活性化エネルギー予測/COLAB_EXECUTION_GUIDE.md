# Google Colabでの実行手順（32000サンプル）

## 📋 概要

32000サンプル（全データ）で活性化エネルギー予測の評価を実行する手順です。

## 🔧 事前準備

### 1. Google Driveにファイルをアップロード

Google Driveに以下のファイル・フォルダを配置してください：

**必要なファイル/フォルダ**:
```
Google Drive/
└── MyDrive/
    └── soturon/  （プロジェクトルート）
        ├── data_lowF_noise.pickle  （プロジェクトルート）
        ├── 活性化エネルギー予測/
        │   ├── evaluate_activation_energy_colab.ipynb  （このノートブック）
        │   ├── evaluate_activation_energy.py
        │   ├── activation_energy.py
        │   └── （その他のファイル）
        ├── 自己教師あり学習/
        │   └── task4_output/
        │       └── best_val_model.pth  （学習済みモデル）
        └── ノイズの付与(共通)/
            └── （ノイズモジュール）
```

### 2. フォルダ構造を確認

- `soturon`フォルダがGoogle Driveの`MyDrive`直下にあることを確認
- フォルダ構造を保持したままアップロードすることが重要

## 📝 実行手順

### ステップ1: Google Colabでノートブックを開く

1. **Google Colabを開く**
   - [Google Colab](https://colab.research.google.com/) を開く

2. **ノートブックをアップロード**
   - `ファイル` → `ノートブックをアップロード`
   - `活性化エネルギー予測/evaluate_activation_energy_colab.ipynb`を選択

3. **GPUを有効化**
   - メニュー: `ランタイム` → `ランタイムのタイプを変更`
   - ハードウェアアクセラレータ: **GPU（T4）** を選択
   - 「保存」をクリック

### ステップ2: セルを順番に実行

ノートブックのセルを上から順番に実行してください：

#### セル1: Google Driveのマウント
- セルを実行すると、Google Driveへのアクセス許可を求められます
- リンクをクリックして認証コードを取得し、入力してください

#### セル2: プロジェクトのパス設定
- **重要**: `PROJECT_PATH = '/content/drive/MyDrive/soturon'`を確認
- Google Drive内のプロジェクトフォルダのパスに合わせて変更してください

#### セル3: 必要なパッケージのインストール
- `scipy`, `numpy`, `torch`をインストール

#### セル4: ノイズモジュールのパス設定
- ノイズモジュールを正しく読み込むための設定

#### セル5: 評価の実行（32000サンプル）
- 32000サンプル（全データ）で評価を実行
- **実行時間**: 約30-40分程度（GPU使用時）

#### セル6: 結果の表示
- 評価結果を表示

#### セル7: 結果の保存（オプション）
- 結果をJSON形式で保存

## ⏱️ 実行時間の目安

- **1000サンプル**: 約1-2分
- **32000サンプル**: 約30-40分（GPU使用時）
- **CPU使用時**: 約2-3時間

## ⚙️ 設定

**デフォルト設定**:
- サンプル数: 32000（全データ）
- ノイズタイプ: `power_supply`（電源ノイズ）
- ノイズレベル: 0.3
- 構造化ノイズ: あり
- デバイス: `cuda`（GPU）

**設定を変更する場合**:
- セル5の`evaluate_activation_energy_prediction`関数の引数を変更
- 例: `noise_type='interference'`に変更すると干渉ノイズを使用

## 📊 出力される結果

- 正解の活性化エネルギー（平均値）
- ノイズ除去前の活性化エネルギー（平均値）
- ノイズ除去後の活性化エネルギー（平均値）
- 誤差（平均値）
- 改善度・改善率

## ⚠️ 注意事項

1. **GPUランタイムを使用**
   - `ランタイム` → `ランタイムのタイプを変更` → `GPU`を選択
   - GPUが利用できない場合は、`device='cpu'`に変更（実行時間が長くなります）

2. **プロジェクトパスの確認**
   - `PROJECT_PATH`を正しく設定してください
   - Google Drive内のパスを確認してください

3. **必要なファイルの確認**
   - `data_lowF_noise.pickle`がプロジェクトルートにあることを確認
   - `best_val_model.pth`が`自己教師あり学習/task4_output/`にあることを確認

## 🔍 トラブルシューティング

### エラー: `ModuleNotFoundError`
- プロジェクトパスが正しく設定されているか確認
- 必要なパッケージがインストールされているか確認

### エラー: `FileNotFoundError`
- `data_lowF_noise.pickle`と`best_val_model.pth`のパスを確認
- Google Driveに正しくアップロードされているか確認

### GPUが使えない
- `ランタイム` → `ランタイムのタイプを変更` → `GPU`を選択
- GPUが利用できない場合は、`device='cpu'`に変更

### 実行が遅い
- GPUランタイムを使用しているか確認
- バッチサイズやサンプル数を調整

## 📁 結果の保存場所

評価結果は以下の場所に保存されます：
- `活性化エネルギー予測/evaluation_results.json`

JSONファイルには以下の情報が含まれます：
- 評価サンプル数
- 誤差（ノイズあり・ノイズ除去後）
- 改善度・改善率
- 活性化エネルギーの平均値（正解・ノイズ除去前・ノイズ除去後）
- タイムスタンプ
